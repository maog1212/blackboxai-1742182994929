<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‰©å“è¯†åˆ«ç³»ç»Ÿ - Object Recognition System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.11.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd@2.2.3"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans SC', sans-serif;
        }
        .prediction-box {
            position: absolute;
            border: 3px solid #10B981;
            background: rgba(16, 185, 129, 0.1);
            box-shadow: 0 0 10px rgba(16, 185, 129, 0.5);
        }
        .prediction-label {
            position: absolute;
            background: #10B981;
            color: white;
            padding: 4px 8px;
            font-size: 14px;
            font-weight: bold;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        #videoCanvas {
            max-width: 100%;
            height: auto;
        }

        /* å…¨å±åŠ è½½åŠ¨ç”» */
        #initialLoader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease-out;
        }

        #initialLoader.fade-out {
            opacity: 0;
            pointer-events: none;
        }

        .loader-content {
            text-align: center;
            color: white;
        }

        .brain-icon {
            width: 120px;
            height: 120px;
            margin: 0 auto 30px;
            position: relative;
            animation: pulse 2s ease-in-out infinite;
        }

        .brain-icon svg {
            width: 100%;
            height: 100%;
            filter: drop-shadow(0 0 20px rgba(255, 255, 255, 0.5));
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.1);
                opacity: 0.8;
            }
        }

        .loading-dots {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }

        .loading-dot {
            width: 12px;
            height: 12px;
            background: white;
            border-radius: 50%;
            animation: bounce 1.4s infinite ease-in-out both;
        }

        .loading-dot:nth-child(1) {
            animation-delay: -0.32s;
        }

        .loading-dot:nth-child(2) {
            animation-delay: -0.16s;
        }

        @keyframes bounce {
            0%, 80%, 100% {
                transform: scale(0);
                opacity: 0.5;
            }
            40% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .loader-text {
            font-size: 24px;
            font-weight: bold;
            margin-top: 20px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .loader-subtext {
            font-size: 14px;
            margin-top: 10px;
            opacity: 0.9;
        }

        .progress-bar-container {
            width: 300px;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            margin: 30px auto 0;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: white;
            border-radius: 2px;
            animation: progress 2s ease-in-out infinite;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        @keyframes progress {
            0% {
                width: 0%;
            }
            50% {
                width: 70%;
            }
            100% {
                width: 100%;
            }
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3B82F6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- å…¨å±åŠ è½½åŠ¨ç”» -->
    <div id="initialLoader">
        <div class="loader-content">
            <div class="brain-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke-linejoin="round"/>
                    <path d="M2 17L12 22L22 17" stroke-linejoin="round"/>
                    <path d="M2 12L12 17L22 12" stroke-linejoin="round"/>
                </svg>
            </div>
            <div class="loader-text">æ™ºèƒ½ç‰©å“è¯†åˆ«ç³»ç»Ÿ</div>
            <div class="loader-subtext">æ­£åœ¨åŠ è½½ AI æ¨¡å‹...</div>
            <div class="loading-dots">
                <div class="loading-dot"></div>
                <div class="loading-dot"></div>
                <div class="loading-dot"></div>
            </div>
            <div class="progress-bar-container">
                <div class="progress-bar"></div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="bg-white shadow-md">
        <div class="container mx-auto px-6 py-4">
            <h1 class="text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-indigo-600">
                ğŸ” æ™ºèƒ½ç‰©å“è¯†åˆ«ç³»ç»Ÿ
            </h1>
            <p class="text-gray-600 mt-2">åŸºäº TensorFlow.js çš„å®æ—¶ç‰©ä½“æ£€æµ‹</p>
        </div>
    </header>

    <main class="container mx-auto px-6 py-8">
        <!-- æ¨¡å‹åŠ è½½çŠ¶æ€ -->
        <div id="loadingSection" class="bg-white rounded-lg shadow-lg p-8 text-center mb-8">
            <div class="loading-spinner mx-auto mb-4"></div>
            <p class="text-gray-700 text-lg font-semibold">æ­£åœ¨åŠ è½½ AI æ¨¡å‹...</p>
            <p class="text-gray-500 text-sm mt-2">é¦–æ¬¡åŠ è½½å¯èƒ½éœ€è¦å‡ ç§’é’Ÿ</p>
        </div>

        <!-- ä¸»è¦åŠŸèƒ½åŒº -->
        <div id="mainSection" class="hidden">
            <!-- æ§åˆ¶é¢æ¿ -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
                <h2 class="text-2xl font-bold mb-6 text-gray-800">é€‰æ‹©è¯†åˆ«æ–¹å¼</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- ä¸Šä¼ å›¾ç‰‡ -->
                    <div class="border-2 border-dashed border-blue-300 rounded-lg p-8 text-center hover:border-blue-500 transition duration-300">
                        <div class="mb-4">
                            <svg class="mx-auto h-16 w-16 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                            </svg>
                        </div>
                        <h3 class="text-lg font-semibold mb-2">ä¸Šä¼ å›¾ç‰‡</h3>
                        <p class="text-gray-600 text-sm mb-4">æ”¯æŒ JPG, PNG, GIF æ ¼å¼</p>
                        <input type="file" id="imageUpload" accept="image/*" class="hidden">
                        <label for="imageUpload" class="inline-block bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-lg cursor-pointer transition duration-300">
                            é€‰æ‹©å›¾ç‰‡
                        </label>
                    </div>

                    <!-- ä½¿ç”¨æ‘„åƒå¤´ -->
                    <div class="border-2 border-dashed border-green-300 rounded-lg p-8 text-center hover:border-green-500 transition duration-300">
                        <div class="mb-4">
                            <svg class="mx-auto h-16 w-16 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                            </svg>
                        </div>
                        <h3 class="text-lg font-semibold mb-2">å®æ—¶æ‘„åƒå¤´</h3>
                        <p class="text-gray-600 text-sm mb-4">å¼€å¯æ‘„åƒå¤´è¿›è¡Œå®æ—¶æ£€æµ‹</p>
                        <button id="enableCamera" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded-lg transition duration-300">
                            å¯åŠ¨æ‘„åƒå¤´
                        </button>
                        <button id="stopCamera" class="hidden bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-6 rounded-lg transition duration-300">
                            åœæ­¢æ‘„åƒå¤´
                        </button>
                    </div>
                </div>
            </div>

            <!-- æ˜¾ç¤ºåŒºåŸŸ -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-2xl font-bold mb-6 text-gray-800">è¯†åˆ«ç»“æœ</h2>

                <!-- å›¾ç‰‡æ˜¾ç¤ºåŒº -->
                <div id="imageContainer" class="relative mb-6 hidden">
                    <canvas id="canvas" class="mx-auto border-2 border-gray-300 rounded-lg"></canvas>
                </div>

                <!-- æ‘„åƒå¤´æ˜¾ç¤ºåŒº -->
                <div id="cameraContainer" class="relative mb-6 hidden">
                    <video id="webcam" autoplay playsinline class="mx-auto border-2 border-gray-300 rounded-lg"></video>
                    <canvas id="videoCanvas" class="absolute top-0 left-0 pointer-events-none"></canvas>
                </div>

                <!-- ç»“æœåˆ—è¡¨ -->
                <div id="resultsContainer" class="hidden">
                    <h3 class="text-xl font-semibold mb-4 text-gray-700">æ£€æµ‹åˆ°çš„ç‰©å“ï¼š</h3>
                    <div id="resultsList" class="space-y-3"></div>
                </div>

                <!-- æ— ç»“æœæç¤º -->
                <div id="noResults" class="text-center py-12 text-gray-400">
                    <svg class="mx-auto h-24 w-24 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                    </svg>
                    <p class="text-lg">ä¸Šä¼ å›¾ç‰‡æˆ–å¯åŠ¨æ‘„åƒå¤´å¼€å§‹è¯†åˆ«</p>
                </div>
            </div>

            <!-- ä½¿ç”¨è¯´æ˜ -->
            <div class="bg-blue-50 rounded-lg p-6 mt-8">
                <h3 class="text-lg font-semibold mb-3 text-blue-900">ğŸ’¡ ä½¿ç”¨è¯´æ˜</h3>
                <ul class="space-y-2 text-blue-800">
                    <li>âœ“ è¯¥ç³»ç»Ÿä½¿ç”¨ COCO-SSD æ¨¡å‹ï¼Œå¯è¯†åˆ« 80 ç§å¸¸è§ç‰©å“</li>
                    <li>âœ“ åŒ…æ‹¬ï¼šäººã€åŠ¨ç‰©ã€è½¦è¾†ã€å®¶å…·ã€é£Ÿç‰©ã€ç”µå­è®¾å¤‡ç­‰</li>
                    <li>âœ“ ç½®ä¿¡åº¦è¶Šé«˜ï¼Œè¯†åˆ«ç»“æœè¶Šå‡†ç¡®ï¼ˆé€šå¸¸ > 0.5 è¾ƒå¯é ï¼‰</li>
                    <li>âœ“ å®æ—¶æ£€æµ‹æ¨¡å¼ä¸‹ï¼Œç³»ç»Ÿä¼šæŒç»­åˆ†ææ‘„åƒå¤´ç”»é¢</li>
                    <li>âœ“ æ‰€æœ‰å¤„ç†å‡åœ¨æµè§ˆå™¨æœ¬åœ°å®Œæˆï¼Œä¸ä¼šä¸Šä¼ æ‚¨çš„å›¾ç‰‡</li>
                </ul>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-white mt-12 py-6 shadow-md">
        <div class="container mx-auto px-6 text-center text-gray-600">
            <p>åŸºäº TensorFlow.js å’Œ COCO-SSD æ¨¡å‹æ„å»º | æœ¬åœ°å¤„ç†ï¼Œä¿æŠ¤éšç§</p>
        </div>
    </footer>

    <script>
        let model = null;
        let webcamStream = null;
        let isDetecting = false;

        // ç¿»è¯‘å¸¸è§ç‰©å“åç§°åˆ°ä¸­æ–‡
        const translations = {
            'person': 'äºº',
            'bicycle': 'è‡ªè¡Œè½¦',
            'car': 'æ±½è½¦',
            'motorcycle': 'æ‘©æ‰˜è½¦',
            'airplane': 'é£æœº',
            'bus': 'å…¬å…±æ±½è½¦',
            'train': 'ç«è½¦',
            'truck': 'å¡è½¦',
            'boat': 'èˆ¹',
            'traffic light': 'äº¤é€šä¿¡å·ç¯',
            'fire hydrant': 'æ¶ˆé˜²æ “',
            'stop sign': 'åœè½¦æ ‡å¿—',
            'parking meter': 'åœè½¦è®¡æ—¶å™¨',
            'bench': 'é•¿å‡³',
            'bird': 'é¸Ÿ',
            'cat': 'çŒ«',
            'dog': 'ç‹—',
            'horse': 'é©¬',
            'sheep': 'ç¾Š',
            'cow': 'ç‰›',
            'elephant': 'å¤§è±¡',
            'bear': 'ç†Š',
            'zebra': 'æ–‘é©¬',
            'giraffe': 'é•¿é¢ˆé¹¿',
            'backpack': 'èƒŒåŒ…',
            'umbrella': 'é›¨ä¼',
            'handbag': 'æ‰‹æåŒ…',
            'tie': 'é¢†å¸¦',
            'suitcase': 'è¡Œæç®±',
            'frisbee': 'é£ç›˜',
            'skis': 'æ»‘é›ªæ¿',
            'snowboard': 'æ»‘é›ªæ¿',
            'sports ball': 'è¿åŠ¨çƒ',
            'kite': 'é£ç­',
            'baseball bat': 'æ£’çƒæ£’',
            'baseball glove': 'æ£’çƒæ‰‹å¥—',
            'skateboard': 'æ»‘æ¿',
            'surfboard': 'å†²æµªæ¿',
            'tennis racket': 'ç½‘çƒæ‹',
            'bottle': 'ç“¶å­',
            'wine glass': 'é…’æ¯',
            'cup': 'æ¯å­',
            'fork': 'å‰å­',
            'knife': 'åˆ€',
            'spoon': 'å‹ºå­',
            'bowl': 'ç¢—',
            'banana': 'é¦™è•‰',
            'apple': 'è‹¹æœ',
            'sandwich': 'ä¸‰æ˜æ²»',
            'orange': 'æ©™å­',
            'broccoli': 'è¥¿å…°èŠ±',
            'carrot': 'èƒ¡èåœ',
            'hot dog': 'çƒ­ç‹—',
            'pizza': 'æŠ«è¨',
            'donut': 'ç”œç”œåœˆ',
            'cake': 'è›‹ç³•',
            'chair': 'æ¤…å­',
            'couch': 'æ²™å‘',
            'potted plant': 'ç›†æ ½',
            'bed': 'åºŠ',
            'dining table': 'é¤æ¡Œ',
            'toilet': 'é©¬æ¡¶',
            'tv': 'ç”µè§†',
            'laptop': 'ç¬”è®°æœ¬ç”µè„‘',
            'mouse': 'é¼ æ ‡',
            'remote': 'é¥æ§å™¨',
            'keyboard': 'é”®ç›˜',
            'cell phone': 'æ‰‹æœº',
            'microwave': 'å¾®æ³¢ç‚‰',
            'oven': 'çƒ¤ç®±',
            'toaster': 'çƒ¤é¢åŒ…æœº',
            'sink': 'æ°´æ§½',
            'refrigerator': 'å†°ç®±',
            'book': 'ä¹¦',
            'clock': 'æ—¶é’Ÿ',
            'vase': 'èŠ±ç“¶',
            'scissors': 'å‰ªåˆ€',
            'teddy bear': 'æ³°è¿ªç†Š',
            'hair drier': 'å¹é£æœº',
            'toothbrush': 'ç‰™åˆ·'
        };

        // åŠ è½½æ¨¡å‹
        async function loadModel() {
            try {
                console.log('å¼€å§‹åŠ è½½æ¨¡å‹...');
                model = await cocoSsd.load();
                console.log('æ¨¡å‹åŠ è½½æˆåŠŸ');

                // éšè—å…¨å±åŠ è½½åŠ¨ç”»
                const loader = document.getElementById('initialLoader');
                loader.classList.add('fade-out');

                // åŠ¨ç”»å®Œæˆåç§»é™¤å…ƒç´ 
                setTimeout(() => {
                    loader.style.display = 'none';
                }, 500);

                document.getElementById('loadingSection').classList.add('hidden');
                document.getElementById('mainSection').classList.remove('hidden');
            } catch (error) {
                console.error('æ¨¡å‹åŠ è½½å¤±è´¥:', error);

                // æ›´æ–°åŠ è½½å™¨æ˜¾ç¤ºé”™è¯¯
                const loader = document.getElementById('initialLoader');
                loader.querySelector('.loader-content').innerHTML = `
                    <div class="text-white">
                        <svg class="mx-auto h-20 w-20 mb-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <p class="text-2xl font-semibold mb-4">æ¨¡å‹åŠ è½½å¤±è´¥</p>
                        <p class="text-sm mb-6">${error.message}</p>
                        <button onclick="location.reload()" class="bg-white text-purple-600 font-bold py-3 px-8 rounded-lg hover:bg-gray-100 transition duration-300">
                            é‡æ–°åŠ è½½
                        </button>
                    </div>
                `;
            }
        }

        // å›¾ç‰‡ä¸Šä¼ å¤„ç†
        document.getElementById('imageUpload').addEventListener('change', async (event) => {
            const file = event.target.files[0];
            if (!file) return;

            // åœæ­¢æ‘„åƒå¤´
            stopWebcam();

            const reader = new FileReader();
            reader.onload = async (e) => {
                const img = new Image();
                img.onload = async () => {
                    const canvas = document.getElementById('canvas');
                    const ctx = canvas.getContext('2d');

                    // è®¾ç½®canvaså¤§å°
                    canvas.width = img.width;
                    canvas.height = img.height;

                    // ç»˜åˆ¶å›¾ç‰‡
                    ctx.drawImage(img, 0, 0);

                    // æ˜¾ç¤ºå›¾ç‰‡å®¹å™¨
                    document.getElementById('imageContainer').classList.remove('hidden');
                    document.getElementById('cameraContainer').classList.add('hidden');
                    document.getElementById('noResults').classList.add('hidden');

                    // è¿›è¡Œé¢„æµ‹
                    await detectObjects(img, canvas);
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        });

        // ç‰©ä½“æ£€æµ‹
        async function detectObjects(image, canvas) {
            if (!model) return;

            try {
                const predictions = await model.detect(image);
                console.log('æ£€æµ‹ç»“æœ:', predictions);

                // ç»˜åˆ¶æ£€æµ‹æ¡†
                const ctx = canvas.getContext('2d');
                ctx.lineWidth = 3;
                ctx.strokeStyle = '#10B981';
                ctx.fillStyle = '#10B981';
                ctx.font = 'bold 16px Arial';

                predictions.forEach(prediction => {
                    const [x, y, width, height] = prediction.bbox;

                    // ç»˜åˆ¶è¾¹ç•Œæ¡†
                    ctx.strokeRect(x, y, width, height);

                    // ç»˜åˆ¶æ ‡ç­¾èƒŒæ™¯
                    const label = `${translations[prediction.class] || prediction.class} ${Math.round(prediction.score * 100)}%`;
                    const textWidth = ctx.measureText(label).width;
                    ctx.fillRect(x, y - 25, textWidth + 10, 25);

                    // ç»˜åˆ¶æ ‡ç­¾æ–‡å­—
                    ctx.fillStyle = 'white';
                    ctx.fillText(label, x + 5, y - 7);
                    ctx.fillStyle = '#10B981';
                });

                // æ˜¾ç¤ºç»“æœåˆ—è¡¨
                displayResults(predictions);
            } catch (error) {
                console.error('æ£€æµ‹å¤±è´¥:', error);
            }
        }

        // æ˜¾ç¤ºç»“æœåˆ—è¡¨
        function displayResults(predictions) {
            const resultsContainer = document.getElementById('resultsContainer');
            const resultsList = document.getElementById('resultsList');

            if (predictions.length === 0) {
                resultsContainer.classList.add('hidden');
                return;
            }

            resultsContainer.classList.remove('hidden');

            resultsList.innerHTML = predictions.map((prediction, index) => {
                const percentage = Math.round(prediction.score * 100);
                const colorClass = percentage > 70 ? 'bg-green-500' : percentage > 50 ? 'bg-yellow-500' : 'bg-orange-500';

                return `
                    <div class="flex items-center justify-between bg-gray-50 p-4 rounded-lg">
                        <div class="flex items-center space-x-4">
                            <div class="w-10 h-10 ${colorClass} rounded-full flex items-center justify-center text-white font-bold">
                                ${index + 1}
                            </div>
                            <div>
                                <p class="font-semibold text-gray-800">${translations[prediction.class] || prediction.class}</p>
                                <p class="text-sm text-gray-500">${prediction.class}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-2xl font-bold ${colorClass.replace('bg-', 'text-')}">${percentage}%</p>
                            <p class="text-xs text-gray-500">ç½®ä¿¡åº¦</p>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // å¯åŠ¨æ‘„åƒå¤´
        document.getElementById('enableCamera').addEventListener('click', async () => {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    }
                });

                const video = document.getElementById('webcam');
                video.srcObject = stream;
                webcamStream = stream;

                video.addEventListener('loadeddata', () => {
                    const canvas = document.getElementById('videoCanvas');
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;

                    document.getElementById('imageContainer').classList.add('hidden');
                    document.getElementById('cameraContainer').classList.remove('hidden');
                    document.getElementById('noResults').classList.add('hidden');
                    document.getElementById('enableCamera').classList.add('hidden');
                    document.getElementById('stopCamera').classList.remove('hidden');

                    isDetecting = true;
                    detectFrame(video, canvas);
                });
            } catch (error) {
                console.error('æ‘„åƒå¤´å¯åŠ¨å¤±è´¥:', error);
                alert('æ— æ³•è®¿é—®æ‘„åƒå¤´ï¼Œè¯·æ£€æŸ¥æƒé™è®¾ç½®');
            }
        });

        // åœæ­¢æ‘„åƒå¤´
        document.getElementById('stopCamera').addEventListener('click', stopWebcam);

        function stopWebcam() {
            if (webcamStream) {
                webcamStream.getTracks().forEach(track => track.stop());
                webcamStream = null;
            }
            isDetecting = false;
            document.getElementById('cameraContainer').classList.add('hidden');
            document.getElementById('enableCamera').classList.remove('hidden');
            document.getElementById('stopCamera').classList.add('hidden');
            document.getElementById('resultsContainer').classList.add('hidden');
            if (document.getElementById('imageContainer').classList.contains('hidden')) {
                document.getElementById('noResults').classList.remove('hidden');
            }
        }

        // å®æ—¶æ£€æµ‹
        async function detectFrame(video, canvas) {
            if (!isDetecting) return;

            const predictions = await model.detect(video);

            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // ç»˜åˆ¶æ£€æµ‹æ¡†
            ctx.lineWidth = 3;
            ctx.strokeStyle = '#10B981';
            ctx.fillStyle = '#10B981';
            ctx.font = 'bold 16px Arial';

            predictions.forEach(prediction => {
                const [x, y, width, height] = prediction.bbox;

                ctx.strokeRect(x, y, width, height);

                const label = `${translations[prediction.class] || prediction.class} ${Math.round(prediction.score * 100)}%`;
                const textWidth = ctx.measureText(label).width;
                ctx.fillRect(x, y - 25, textWidth + 10, 25);

                ctx.fillStyle = 'white';
                ctx.fillText(label, x + 5, y - 7);
                ctx.fillStyle = '#10B981';
            });

            displayResults(predictions);

            requestAnimationFrame(() => detectFrame(video, canvas));
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.addEventListener('load', loadModel);
    </script>
</body>
</html>
